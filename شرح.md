ما هو MQTT؟

MQTT هو بروتوكول مراسَلة خفيف الوزن يعتمد على نمط «النشر-الاشتراك» (Publish/Subscribe)، صُمِّم خصيصاً لشبكات بطيئة أو غير موثوقة، ويُستخدم بكثافة في تطبيقات إنترنت الأشياء (IoT) والأجهزة المحمولة.

أهم الميزات:
- حجم حزم صغير واستهلاك منخفض للبطارية والمعالج.
- ثلاثة مستويات لضمان التوصيل (QoS 0, 1, 2).
- رسائل «الوصية الأخيرة» (Last Will) تُعلم الآخرين عند فقدان الاتصال.
- إمكانية الاحتفاظ بالرسالة الأخيرة على الموضوع (Retained) لتصل للمشتركين الجدد.

---

بوابة SMS على أندرويد باستخدام MQTT

باختصار، يمكن تحويل هاتف أندرويد إلى «بوابة SMS» تستقبل أوامر وترسل رسائل قصيرة عبر بروتوكول MQTT دون الحاجة إلى خدمة SMS API مدفوعة من طرف ثالث.

آلية العمل
1. إرسال رسالة:
   - تنشر رسالة MQTT على الموضوع `sms/send` بالصيغة:
     
```json
     {"number":"+9665xxxxxxx", "text":"مرحباً"}
     ```

   - التطبيق يستقبل الأمر ويرسل SMS فعلياً من الشريحة.
   - يرسل تأكيد التسليم إلى موضوع `sms/sent`.

2. استقبال رسالة:
   - عند وصول SMS إلى الهاتف، يقوم التطبيق بنشر محتواها إلى موضوع `sms/received`.

أبرز الميزات
- دعم شرائح متعددة (إذا كان الهاتف يدعمه).
- محاولات إعادة إرسال تلقائية (3 مرات).
- إشعارات «تم الإرسال» و«تم التوصيل».
- إمكانية استخدامه كـ API SMS مجاني.

أدوات مشهورة جاهزة
1. تطبيق Android-SMS-Gateway-MQTT (مفتوح المصدر):
   - [تحميل APK](https://github.com/ibnux/Android-SMS-Gateway-MQTT/releases) أو بناء الكود المصدري.
   - يتضمن ملف PHP (`php-gateway`) لتشغيله على السيرفر.

2. sms2mqtt عبر مودم USB:
   - يفضل من لديه مودم USB GSM (Huawei أو غيره).
   - يعمل داخل حاوية Docker:
     
```bash
     docker run -d --name sms2mqtt --device=/dev/ttyUSB0:/dev/mobile \
       -e HOST="mqtt.example.com" -e USER="usr" -e PASSWORD="pass" \
       domochip/sms2mqtt
     ```

   - الموضوعات:
     - إرسال: `sms2mqtt/send`
     - استقبال: `sms2mqtt/received`

3. حل DIY باستخدام Zanzito:
   - تطبيق Zanzito على الأندرويد + وسيط MQTT (Mosquitto).
   - مثال خدمة مصغرة: [مستودع sms-gateway](https://github.com/t0mer/sms-gateway).

خطوات التشغيل السريع
1. حمِّل تطبيق [Android-SMS-Gateway-MQTT](https://github.com/ibnux/Android-SMS-Gateway-MQTT/releases) وثبّته.
2. أدخل إعدادات الوسيط (Broker) مثل `broker.hivemq.com` على المنفذ 1883.
3. اختبر الإرسال:
   - أنشر رسالة على `sms/send` بالصيغة السابقة.
   - تفحص موضوع `sms/sent` لتأكيد التسليم.
4. لاستقبال الرسائل، اشترك في `sms/received`.

> ملاحظة: تأكد من التزامك بسياسة الاستخدام العادل لدى مشغِّل الاتصالات لتجنب حجب الخدمة.

بالتوفيق!